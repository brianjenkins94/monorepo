{
	"name": "ci",
	"on": {
		"push": {
			"branches": ["main"]
		}
	},
	"jobs": {
		"build": {
			"runs-on": "ubuntu-latest",
			"steps": [
				{ "uses": "actions/checkout@v3" },
				{ "uses": "actions/setup-node@v3", "with": { "node-version": 18 } },
				{ "run": "npm install" },
				{ "run": "npm run build" }
			]
		},
		"lint": {
			"runs-on": "ubuntu-latest",
			"steps": [
				{ "uses": "actions/checkout@v3" },
				{ "uses": "actions/setup-node@v3", "with": { "node-version": 18 } },
				{ "run": "npm install" },
				{ "run": "npm run lint" }
			]
		},
		"test": {
			"runs-on": "ubuntu-latest",
			"steps": [
				{ "uses": "actions/checkout@v3" },
				{ "uses": "actions/setup-node@v3", "with": { "node-version": 18 } },
				{ "run": "npm install" },
				{ "run": "npm run test" }
			]
		},
		"changes": {
			"runs-on": "ubuntu-latest",
			"needs": ["build", "lint", "test"],
			"steps": [
				{ "uses": "actions/checkout@v3" },
				{ "uses": "actions/setup-node@v3", "with": { "node-version": 18 } },
				{ "run": "npm install" },
				{
					"id": "packages",
					"run": "echo PACKAGES=\"[$(find . -mindepth 2 -name \"package.json\" -not -path \"*/.*\" -not -path \"*/node_modules/**\" | sed -z \"s/^/\\\"/;s/\\n$/\\\"/;s/\\n/\\\",\\\"/g\")]\" >> $GITHUB_OUTPUT"
				}
			],
			"outputs": {
				"packages": "${{ steps.packages.outputs.PACKAGES }}"
			}
		},
		"release": {
			"runs-on": "ubuntu-latest",
			"needs": ["changes"],
			"strategy": {
				"matrix": {
					"packages": "${{ fromJSON(needs.changes.outputs.PACKAGES) }}"
				}
			},
			"steps": [
				{
					"run": "echo ${{ matrix.package }}"
				}
			]
		}
	}
}
